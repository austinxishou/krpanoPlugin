!function(t){"function"==typeof define&&define.amd?(require.config({paths:{comment:["/p/hotspot/comment/"]}}),define(["jquery","template","krpanoPluginJs","proxy","comment/commentform.tpl","comment/comment.tpl","css!comment/comment.css"],t)):t(jQuery,template,krpanoPluginJs,proxy)}(function(t,n,o,e,i,c){function m(t,n){h=t,a=n}var s,h,a,r=m.prototype;return r.options={time:1200,x:function(){var n=t(".comment_form").position();return n.left-80},y:function(){var n=t(".comment_form").position();return n.top/2+80},onupdate:function(t,n){var i;return e.commentAdd({sceneId:o.getSceneId(),comment:n.content,avatar:n.pic,ath:t.ath,atv:t.atv,mainPanoId:panoId,async:!1},function(n){return n.success?void(i=n.id):(alert(n.errMsg),void a.removeComment(t.name))}),this.bg.width(this.pic.width()),i},ondoned:function(){this.onresize(),this.comment.addClass("comment_finsh"),s.content.val("")}},r.view=function(){var c="/images/1234.png";this.options={icon:"/v2.0/store/images/sub.png",realTimeClick:!0},this.init=function(e){s=this,this.dom=e,this.comment=t(n(i,{})),this.comment.hide(),o.addChilde(this.comment,!0),this.form=this.comment.find("form"),this.content=this.comment.find(".comment_form_content"),this.cancel=this.comment.find(".comment_form_cancel"),this.initEvent()},this.show=function(){this.comment.show(),a.addComment(c)},this.hide=function(){this.comment.hide()},this.initEvent=function(){this.form.submit(function(){return s.content.val().length>28?(alert("不能超过28个字"),!1):0==s.content.val().length?(alert("请输入评论"),!1):(a.saveComment(s.content.val()),s.dom.data("hide")(),!1)}),t("<button>说一说</button>").appendTo("body").css({position:"absolute",left:0,bottom:0}).click(function(){s.show()}),this.cancel.click(function(){a.removeComment(),s.dom.data("hide")()})},this.onloadcomment=function(t){var n;return e.commentGet({mainPanoId:panoId,sceneId:t,async:!1},function(t){t.success||alert(t.errMsg),n=t}),n.data}},r.commentspot=function(){var e=this,i={};this.init=function(e,m){return i.content=m.content,i.pic=m.pic,this.comment=t(n(c,i)),this.bg=this.comment.find(".comment_bg"),this.pic=this.comment.find(".comment_pic img"),this.content=this.comment.find(".comment_content"),o.addPluginChilde(m,this.comment),this.onresize(),m.onclick=function(){1!=m.is_save},this.comment},this.onresize=function(){this.content.css({"white-space":"nowrap"});var t=this.content.width()+this.pic.width();this.content.css({"white-space":"inherit"}),this.bg.width(t+25),this.bg.removeClass("comment_max")},this.onremove=function(){},this.onupdate=function(t){e.pic.attr("src",t.pic),e.content.html(html_encode(t.content))}},m});