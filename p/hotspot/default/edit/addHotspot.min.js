!function(t){"function"==typeof define&&define.amd?(require.config({paths:{layer:"/dist/modul/layer",layerExt:"/dist/extend/layer.ext"},shim:{layerExt:["layer"]}}),define(["jquery","template","krpanoPluginJs","proxy","hotspot/registehotspot","layer","layerExt","css!/depend/css/layer.ext.css","/p/hotspot/default/edit/addpicture.tpl.js","/p/hotspot/default/edit/hotView.tpl.js","css!/p/hotspot/default/edit/hotView.css","/p/hotspot/default/edit/addhotspotIcon.tpl.js","/p/hotspot/default/edit/addfont.tpl.js","/depend/util/model.js","jquery.fileupload","jquery.fileupload-validate","jquery.fileupload-image","load-image","/p/hotspot/default/edit/index.tpl.js","/depend/tabLeftRight/simplefoucs.js","/depend/upLoadImg/upLoadImg.js","css!/p/hotspot/default/edit/addHotspot.css","/p/hotspot/default/edit/hotspotDelet.tpl.js","/depend/scrollBar/jquery.mCustomScrollbar.concat.min.js","css!/depend/scrollBar/jquery.mCustomScrollbar.min.css"],t)):t(jQuery,template,krpanoPluginJs,proxy)}(function(t,o,e,i,n,s){function d(t,o){c=t,m=o}var a,c,m,r=d.prototype;return r.edit=function(){this.options={icon:"/v2.0/images/hotspotImg.png"},a=this;var s,d;this.init=function(t){a=this,this.dom=t,this.initEvent(),s=n.getInstance("spot",{element:a.commentspot,isSaveMove:!0,saveFlag:!0,callback:{onnewscene:function(){}}})},this.show=function(){d=s.addHotspot({iconName:"spoticon2",data:{}}),d.callwith("onclick"),this.dom.data("curr",!1)},this.hide=function(){_this.comment.hide()},this.initEvent=function(){},this.commentspot=function(){var n=this;this.init=function(i,s){n.comment=t(o(addhotspotIcon,{})).hide().data("curr",!1);var d=t(o(addpicture,i)),a={list:e.getIconPackage()},c=t(o(addfont,a)),m=t(o(hotspotDelet,{}));n.comment.find(".hotspot-edit").append(d),n.comment.find(".hotspot-label").append(c),n.comment.find(".hotspot-delete").append(m);var r=n.comment.find(".hotspot-i i");if(this.title=n.comment.find(".addHot-title-title"),this.content=n.comment.find(".textarea-content"),this.address=n.comment.find(".addHot-title-address"),this.upImg=n.comment.find(".hotfileList"),r.click(function(){r.siblings().hide(),t(this).siblings().show()}),i&&(this.title.val(i.title),this.content.html(i.content),this.address.val(i.url),i.pic)){var l='<%for(var i = 0; i < data.pic.length; i++){%><div class="showImg"><img src="../p/hotspot/default/images/delet.png" class="deleteHimg"><img src="<%=data.pic[i]%>" class="setImgwh"></div><%}%>',c=t(o(l,i));this.upImg.append(c),n.comment.find(".bottom-btn ul li").removeClass("curr"),n.comment.find(".bottom-btn ul li.picture").addClass("curr"),n.comment.find(".up-hotpicture").show()}n.comment.on("click",".bottom-btn li.com",function(){var o=t(this).index();1==o?(n.comment.find(".up-hotpicture").show(),t(this).addClass("curr"),t(this).siblings().removeClass("curr")):(n.comment.find(".up-hotpicture").hide(),t(this).addClass("curr"),t(this).siblings().removeClass("curr"))}),upLoadImg(n.comment.find(".aloneupfile")),n.comment.on("click",".deleteHimg",function(){t(this).parent().remove()}),n.comment.on("click",".close",function(){t(this).parents(".hotspot-edit-common").hide()});for(var h=n.comment.find(".listIcon"),p=(n.comment.find(".apply_w"),n.comment.find(".apply_array")),u=0;u<a.list.length;u++)for(var f=t("<ul class='getSpot'/>").appendTo(h),v=0;v<a.list[u].styleList.length;v++){var g=a.list[u].styleList[v];li=t("<li/>").appendTo(f),li.click(function(){{var o=t(this).data();o.url}n.hotspotFn.loadStyle(o.name),t(this).parents(".hotspot-edit-common").hide();t(this).parents(".hotspot-i").data("hotspot");return!1}).data(g),t("<img>").appendTo(li).attr("src",g.thumb)}n.comment.on("click",".apply_array",function(){p.removeClass("curr"),t(this).addClass("curr");var o=t(this).index();n.comment.find(".getSpot").hide(),n.comment.find(".getSpot").eq(o).show()});var w=n.comment.find(".apply_w");return botscroll(w),n.comment.on("click",".addSave",function(){var o=n.comment.find(".bottom-btn ul li.curr").attr("type"),i=n.comment.find(".textarea-content").val(),s=n.comment.find(".addHot-title-title").val(),d=n.comment.find(".addHot-title-address").val(),a=n.comment.find(".hotfileList .showImg").length,c=[];n.comment.find(".showImg").each(function(){var o=t(this).find("img.setImgwh").attr("src");c.push(o)}),n.hotspotFn.saveHotspot({data:{type:o,content:i,title:s,linkUrl:d,thumbL:a,list:c,mainPanoId:panoId,panoId:e.getSceneId(),address:d}})}),n.comment.on("click",".confirm",function(){n.hotspotFn.removeHotspot()}),n.comment.on("click",".cancel",function(){n.comment.find(".hotspot-delete-model").hide()}),s&&n.comment.addClass("comment_finsh"),n.comment},this.onresize=function(){},this.onremove=function(t){i.hotspotDelete({id:t},function(t){return t.success?void msg("删除成功"):void msg(t.errMsg)})},n.vlidate=function(t,o){var e={};if(""==t.type)return void msg("系统错误",function(){n.comment.find(".textarea-content").focus()});if(""==t.title)return void msg("请填标题",function(){n.comment.find(".addHot-title-title").focus()});if(4==t.type&&""==t.content)return void msg("请填写内容",function(){n.comment.find(".textarea-content").focus()});if(1==t.type&&t.thumbL<=0)return void msg("请上传图片",function(){});e.pics=t.list,t.address?(e.linkUrl=t.address,e.isLinkUse=0):e.isLinkUse=1;return e.resourceType=t.type,e.title=t.title,e.content=t.content,e.atv=o.atv,e.ath=o.ath,e.async=!1,e.mainPanoId=t.mainPanoId,e.panoId=t.panoId,e.hotspotType=1,e.type=2,e},this.onsave=function(t,o){var s,d=n.vlidate(t,o);return d.iconId=o.iconid,d?(i.addHotspot(d,function(t){return t.success?(e.set("hotspot["+o.name+"].id",t.id),msg("添加成功"),void(s=t.id)):void msg(t.errMsg)}),s):void 0},this.onupdate=function(t,o){var e=n.comment.find(".bottom-btn ul li.curr").attr("type"),s=n.vlidate(t,o);s.id=o.id,s.resourceType=e,s.iconId=o.iconid,s&&i.addHotspot(s,function(t){return t.success?void msg("修改成功"):void msg(t.errMsg)})},this.onmoveupdate=function(t,o){o.is_save&&i.addHotspot({atv:o.atv,ath:o.ath,mainpanoid:panoId,id:o.id},function(t){return t.success?void 0:void msg(t.errMsg)})},this.onupdatestyle=function(t){n.comment.css("top",t.y-40)},this.onclick=function(){if(0==n.comment.data("curr")){var t=n.hotspotFn.getHotspot();for(var o in t){var e=t[o].element;e?(e.comment.hide().data("curr",!1),e.hotspotFn.zorder(!1)):console.log(t[o])}n.comment.show().data("curr",!0),n.hotspotFn.zorder(!0)}n.comment.find(".up-hotpicture .upallpic").mCustomScrollbar(),n.comment.find(".hotspot-edit-link .content .listIcon").mCustomScrollbar()}}},r.view=function(){a=this,this.init=function(){hotspotFn=n.getInstance("spot",{element:a.commentspot,saveFlag:!0,isInitIconEvent:!0})},this.commentspot=function(){var e=this;this.init=function(i,n){this.hotspotElement=t("<div class='hotspot'/>").delegate(".model .contents","mousedown",function(){return!1}),e.comment=t(o(hotView,{}));var d=e.comment.find(".hotTitle"),a=e.comment.find(".hotContent"),c=e.comment.find(".hotPictureShow"),m=e.comment.find(".hotspot-view-detail");if(i){if(d.html(i.title),a.html(i.content),i.url?(m.attr("href",i.url),e.comment.find(".hotspot-view-detailAll").show()):e.comment.find(".hotspot-view-detailAll").hide(),i.pic){var r='<%for(var i = 0; i < data.pic.length; i++){%><div class="bg_img"><img src="<%=data.pic[i]%>" class="setImgwh"></div><%}%><span class="picSum"><%=data.pic.length%>张</span>',l=t(o(r,i));c.append(l);var h=e.comment.find(".hotPictureShow")}e.comment.find(".hotspot-viewPsre").mouseover(function(){t(this).children(".hotspot-view-icon-show").css("transform","rotate(180deg)"),t(this).removeClass("hotspot-view-Width").addClass("hotspot-view-yWidth"),t(this).parents(".model").css("width","262px"),e.hotspotFn.zorder(!0)}).mouseout(function(){t(this).children(".hotspot-view-icon-show").css("transform","rotate(0deg)"),t(this).removeClass("hotspot-view-yWidth").addClass("hotspot-view-Width"),t(this).parents(".model").css("width","155px"),e.hotspotFn.zorder(!1)})}this.addViewHot("viewEdit",e.comment);return console.log(s),s.photos({closeBtn:2,move:!1,moveOut:!1,photos:h,tab:function(o,e){var i=e.width(),n=e.height(),s=e.width()+200,d=e.height()+200,a=t(window).width(),c=t(window).height();if(s>a||d>c){var m=1;m=s-a>d-c?a/s:c/d,e.css({width:i*m,height:n*m}),t(window).resize()}}}),n&&e.comment.addClass("comment_finsh"),this.hotspotElement},this.addViewHot=function(o,e){var i={},n=t("<div class='hotspot-view hotspot-"+o+"'></div>").appendTo(this.hotspotElement);if(e){var s=t("<div class='hotspot-"+o+"-model'/>").appendTo(n).model({content:e,hasButton:!1});i.button=n,i.model=s,i.modelElement=s.element,i.isShow=!0,n.data("hotspot",i),n.data("name",o),n.on("close",function(){i.isShow=!1})}return i}}},d});