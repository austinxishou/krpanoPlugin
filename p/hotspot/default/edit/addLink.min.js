!function(t){"function"==typeof define&&define.amd?define(["jquery","template","krpanoPluginJs","proxy","hotspot/registehotspot","/depend/util/model.js","/p/hotspot/default/edit/index.tpl.js","/p/hotspot/default/edit/addfont.tpl.js","/depend/tabLeftRight/simplefoucs.js","css!/p/hotspot/default/edit/index.css"],t):t(jQuery,template,krpanoPluginJs,proxy)}(function(t,o,n,e,i){function s(t){d=t}var a,d,l=s.prototype;return l.edit=function(){a=this,this.init=function(t){this.dom=t,hotspotFn=i.getInstance("link_scene",{element:this.spot,isSaveMove:!0,saveFlag:!0})},this.show=function(){hotspot=hotspotFn.addHotspot({iconName:"spoticon2",data:{}}),this.dom.data("curr",!1)},this.hide=function(){this.comment.hide()},this.spot=function(){var i=this;this.listButton={},this.init=function(o){return this.hotspotElement=t("<div class='hotspot'/>").delegate(".model .contents","mousedown",function(){return!1}),this.initLink(o),this.initLabel(),this.initDelete(),this.hotspotElement},this.onresize=function(){},this.onremove=function(){},this.onsave=function(o,i){var s=o.scene,a=t(this),o=n.updateHotspot(i.name);return o.success?void e.hotspotAddLink({hotspotId:i.id,linkedId:s.id,linkedScene:s.name},function(o){if(!o.success)return void msg(o.errMsg);msg("添加成功");var n=t(a).parents(".hotspot-i").data("hotspot");n.model.close()}):void msg(o.errMsg)},this.onupdate=function(){},this.onclick=function(){},this.addView=function(o,n,e){var s={},a=this,d=t("<div class='hotspot-i hotspot-"+o+"'><i class='icon-"+o+"'/></div>").appendTo(this.hotspotElement);if(n&&e){var l=t("<div class='hotspot-"+o+"-model'/>").appendTo(d).model({title:n,content:e,hasButton:!1});d.find(".icon-"+o).click(function(){var o=t(this).parents(" .hotspot-i"),n=o.data("hotspot"),e=o.data("name");t.each(a.listButton,function(t,o){o.isShow&&e!=t&&(o.model.close(),o.isShow=!1)}),n.isShow||(n.model.open(),n.isShow=!0)}),s.button=d,s.model=l,s.modelElement=l.element,s.isShow=!1,d.data("hotspot",s),d.data("name",o),i.listButton[o]=s,d.on("close",function(){s.isShow=!1})}return s},this.initLink=function(){var o=n.getScene(),e=t("<ul/>");for(var s=0 in o)t("<li/>").appendTo(e).html(o[s].title).data("scene",o[s]).click(function(){var o=t(this).data("scene");i.hotspotFn.saveHotspot({data:{sceneId:o.id,sceneName:o.name}})});this.addView("link","选择连接场景",e),t(".hotspot-link-model .content").mCustomScrollbar()},this.initLabel=function(){for(var e={list:n.getIconPackage()},i=t(o(addfont,e)),s=i.find(".listIcon"),a=(i.find(".apply_w"),i.find(".apply_array")),d=0;d<e.list.length;d++)for(var l=t("<ul class='getSpot'/>").appendTo(s),c=0;c<e.list[d].styleList.length;c++){var h=e.list[d].styleList[c],p=t("<li/>").appendTo(l);p.click(function(){var o=t(this),n=t(this).data();return o.hotspotFn.loadStyle(n.name),hotspot.model.close(),!1}).data(h),t("<img>").appendTo(p).attr("src",h.thumb)}i.on("click",".apply_array",function(){a.removeClass("curr"),t(this).addClass("curr");var o=t(this).index();i.find(".getSpot").hide(),i.find(".getSpot").eq(o).show()}),this.addView("label","选择图标样式",i),t(".hotspot-label-model .content .listIcon").mCustomScrollbar(),botscroll()},this.initDelete=function(){var o=t("<p>确定删除此连接器?</p><div><button type='button' class='cancel'>取消</button><button type='button' class='sure confirm'>确定</button></div>"),n=this.addView("delete","提示信息",o);n.modelElement.on("confirm",function(){i.hotspotFn.removeHotspot()})}}},s});