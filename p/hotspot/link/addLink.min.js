!function(t){"function"==typeof define&&define.amd?define(["jquery","template","krpanoPluginJs","proxy","hotspot/registehotspot","/depend/util/model.js","/p/hotspot/link/index.tpl.js","/p/hotspot/link/addfont.tpl.js","/depend/tabLeftRight/simplefoucs.js","css!/p/hotspot/link/index.css","/depend/scrollBar/jquery.mCustomScrollbar.concat.min.js","css!/depend/scrollBar/jquery.mCustomScrollbar.min.css"],t):t(jQuery,template,krpanoPluginJs,proxy)}(function(t,e,o,n,i){function s(t){c=t}var a,c,l=s.prototype;return l.view=function(){a=this,this.init=function(){hotspotFn=i.getInstance("link_scene",{element:this.spot,isSaveMove:!1,isInitIconEvent:!0})},this.spot=function(){this.init=function(e){return this.hotspotElement=t("<div class='hotspot-link-view'/>").html(o.getSceneName(e.sceneName)),this.hotspotElement},this.onclick=function(t){t.sceneName?o.sceneViewChange(t.sceneName):logger.error("跳转失败")},this.onupdatestyle=function(t){this.hotspotElement.css({top:t.y-7,left:2*t.x+12})}}},l.edit=function(){this.options={icon:"/v2.0/images/linkImg.png"},a=this,this.init=function(t){this.dom=t,hotspotFn=i.getInstance("link_scene",{loadSceneRemoveHotspot:!0,element:this.spot,isSaveMove:!0,saveFlag:!0,isInitIconEvent:!0})},this.show=function(){hotspot=hotspotFn.addHotspot({iconName:"spoticon2",data:{}}),hotspot.callwith("onclick"),this.dom.data("curr",!1)},this.hide=function(){this.comment.hide()},this.spot=function(i){var s=this;this.listButton={},this.init=function(e,o){return this.hotspotElement=t("<div class='hotspot'/>").delegate(".model .contents","mousedown",function(){return!1}).hide().data("curr",!1),this.initLink(e,o),this.initLabel(e,o),this.initDelete(),this.hotspotElement},this.onclick=function(){if(0==this.hotspotElement.data("curr")){var t=this.hotspotFn.getHotspot();for(var e in t){var o=t[e].element;o?(o.hotspotElement.hide().data("curr",!1),o.hotspotFn.zorder(!1)):console.log(t[e])}this.hotspotElement.find(".content").mCustomScrollbar(),this.hotspotElement.show().data("curr",!0),this.hotspotFn.zorder(!0)}},this.onresize=function(){},this.onremove=function(t){n.hotspotDelete({id:t,belongPanoId:panoId},function(t){return t.success?void 0:void msg(t.errMsg)})},this.onsave=this.onupdate=this.onmoveupdate=function(t,e){var i,a=e.is_save;if(t&&t.sceneId&&t.sceneName){var c={ath:e.ath,atv:e.atv,hotspotType:o.getHotspotType(e.hotspot_type),type:2,mainPanoId:panoId,panoId:o.getSceneId(),linkedId:t.sceneId,linkedScene:t.sceneName,iconId:e.icon_id,async:!1};return a&&(c.id=e.id),n.hotspotAddLink(c,function(t){return t.success?(s.lable.model.close(),s.link.model.close(),void(i=t.id)):void msg(t.errMsg)}),i}},this.onupdatestyle=function(t){s.hotspotElement.css("top",t.y-5)},this.addView=function(e,o,n){var i={},a=this,c=t("<div class='hotspot-i hotspot-"+e+"'><i class='icon-"+e+"'/></div>").appendTo(this.hotspotElement);if(o&&n){var l=t("<div class='hotspot-"+e+"-model'/>").appendTo(c).model({title:o,content:n,hasButton:!1});c.find(".icon-"+e).click(function(){var e=t(this).parents(" .hotspot-i"),o=e.data("hotspot"),n=e.data("name");t.each(a.listButton,function(t,e){e.isShow&&n!=t&&(e.model.close(),e.isShow=!1)}),o.isShow||(o.model.open(),o.isShow=!0)}),i.button=c,i.model=l,i.modelElement=l.element,i.isShow=!1,c.data("hotspot",i),c.data("name",e),s.listButton[e]=i,c.on("close",function(){i.isShow=!1})}return i},this.initLink=function(e){var n=o.getCurrScenes(),i=t("<ul/>");for(var a=0 in n){var c=t("<li/>").appendTo(i).html(n[a].title).data("scene",n[a]).click(function(){var e=t(this).data("scene");i.find("li").removeClass("curr"),t(this).addClass("curr"),s.hotspotFn.saveHotspot({data:{sceneId:e.id,sceneName:e.name}})});e&&e.sceneId==n[a].id&&c.addClass("curr")}this.link=this.addView("link","选择连接场景",i)},this.initLabel=function(){var n={list:o.getIconPackage()},a=t(e(link_icon,n)),c=a.find(".listIcon"),l=a.find(".apply_w"),d=a.find(".apply_array");botscroll(),a.on("click",".apply_array",function(){d.removeClass("curr"),t(this).addClass("curr");var e=t(this).index();a.find(".getSpot").hide(),a.find(".getSpot").eq(e).show()});for(var r=0;r<n.list.length;r++)for(var h=t("<ul class='getSpot'/>").appendTo(c),p=0;p<n.list[r].styleList.length;p++){var u=n.list[r].styleList[p],m=t("<li/>").appendTo(h);m.click(function(){var e=t(this).data();return c.find(".curr").removeClass("curr"),t(this).addClass("curr"),s.hotspotFn.loadStyle(e.name),s.lable.model.close(),!1}).data(u),t("<img>").appendTo(m).attr("src",u.thumb),parseInt(i.icon_id)==u.iconid&&(m.addClass("curr"),l.find("li:eq("+r+")").click())}this.lable=this.addView("label","选择图标样式",a),c.mCustomScrollbar()},this.initDelete=function(){var e=t("<p>确定删除此连接器?</p><div><button type='button' class='cancel'>取消</button><button type='button' class='sure confirm'>确定</button></div>"),o=this.addView("delete","提示信息",e);o.modelElement.on("confirm",function(){s.hotspotFn.removeHotspot()})}}},s});